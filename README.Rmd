---
output: github_document
---

# TSLC

<!-- badges: start -->
<!-- badges: end -->

The goal of TSLC is to take into account information on both the taxa and genes/gene pathways in order to find differentially abundant taxa that are associated with a potential difference in function across two populations of interest. This is a two-stage approach that looks at differences in function across the population in the first stage, and then looks at differences in the taxa associated with each differentially abundant function in the second stage.

## Installation

You can install the development version of TSLC like so:

``` r
install_github(repo = "rgbeblavy/TSLC")
```

## Example

Here, we will illustrate how to use this package to implement the two-stagewise approach to find differentially abundant taxa given differentially abundant functions. For the ease of illustration, we use a very low-dimensional data set consisting of 10 subjects, 10 taxa, and 5 gene pathways.

First, we will load in the file 'wmg_demo_data.csv', which gives synthetic data on the functions, as well as the taxa contributing to each function. In this data frame, the rows that do not have a vertical bar "|" give the aggregated abundances of each of the synthetic pathways, while the rows with a vertical bar tell us the contribution of the taxon to each function. The following chunk of code loads this file.

```{r example, message = FALSE, warning = FALSE}
library(tidyverse)
library(TSLC)

wmg.dat <- read.csv(file = "wmg_demo_data.csv", header = TRUE)
wmg.dat[,1] <- NULL # Remove the index column
head(wmg.dat, 7)
```


Now, we just need a data frame that contains the outcome and any covariates of interest for each of the subjects. We will store this information in the variable 'meta.data'. Note that the names in the SampleID column correspond to the column names in the previous data frame. For illustration purposes, we randomly generate this dataset. However, this would be obtained from real data in practice.

```{r}
set.seed(2025)
y <- c(rep(1,5), rep(0,5)) # response variable
x <- rnorm(n = 10, mean = 0, sd = 1) # covariate

meta.data <- data.frame("SampleID" = colnames(wmg.dat)[-1],
                        "y" = y,
                        "X" = x)
head(meta.data)
```

The function get.brp.taxa() implementing our two stage approach takes these two data frames as arguments.

```{r}
res <- get.brp.taxa(wmgs.dat = wmg.dat, meta.dat = meta.data)
```

The outputs of the function get.brp.taxa() contains a list of the following information:

1. results for DA analysis on functions

```{r}
fun.res <- res$fun.res
head(fun.res)
```

2. results for identifying BRp taxa given DA functions

```{r}
tax.res <- res$tax.res
head(tax.res)
```


3. names of all taxa identified as BRp

```{r}
brp.tax <- res$brp.tax
head(brp.tax)
```








